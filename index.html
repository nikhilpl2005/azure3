<!DOCTYPE html>
<html>
<head>
<title>Car Dodge Runner</title>
<meta charset="UTF-8">
<style>
    body {
        margin:0;
        overflow:hidden;
        background: linear-gradient(120deg, #ff0000, #222, #333);
        animation: gradientMove 8s infinite alternate;
        background-size: 200% 200%;
    }

    /* Gradient animation */
    @keyframes gradientMove {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    canvas {
        display:block;
        background: transparent; /* canvas is clear, body shows gradient */
    }

    #score {
        position:fixed; top:20px; left:20px;
        font-size:28px; color:white; font-family:Arial;
        text-shadow: 0px 0px 5px black;
    }
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="score">Score: 0</div>

<script>
/* -----------------------------------------
         IMPROVED CAR-DODGE GAME
-------------------------------------------*/

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// 3 Road Lanes
let laneX = [
    canvas.width/2 - 150,
    canvas.width/2,
    canvas.width/2 + 150
];

let playerLane = 1;
let targetLane = 1;
let playerY = canvas.height - 160;
let playerX = laneX[1];
let switchSpeed = 0.2;

let obstacles = [];
let speed = 7;
let score = 0;
let alive = true;
let paused = false;

let carColors = ["#ff4d4d", "#ffa31a", "#ffff1a", "#4dff4d", "#1affff", "#b31aff"];

// Key Controls
document.addEventListener("keydown", e => {
    if (e.code === "KeyP") paused = !paused;
    if (!alive || paused) return;

    if (e.code === "ArrowLeft" && targetLane > 0) targetLane--;
    if (e.code === "ArrowRight" && targetLane < 2) targetLane++;
});

// Spawn Cars
setInterval(() => {
    if (!alive || paused) return;

    obstacles.push({
        lane: Math.floor(Math.random()*3),
        y: -200,
        color: carColors[Math.floor(Math.random()*carColors.length)],
        height: 140,
        width: 90,
        speed: speed + Math.random()*3
    });
}, 700);

// Smooth Player Move
function updatePlayerPosition() {
    let targetX = laneX[targetLane];
    playerX += (targetX - playerX) * switchSpeed;
}

// Draw Player
function drawPlayer() {
    ctx.fillStyle = "#00e6e6";
    ctx.fillRect(playerX - 45, playerY, 90, 130);

    ctx.fillStyle = "black";
    ctx.fillRect(playerX - 25, playerY + 20, 50, 90);
}

// Draw Cars
function drawObstacles() {
    obstacles.forEach(o => {
        ctx.fillStyle = o.color;
        ctx.fillRect(laneX[o.lane] - 45, o.y, o.width, o.height);

        ctx.fillStyle = "black";
        ctx.fillRect(laneX[o.lane] - 25, o.y + 25, 50, o.height - 50);
    });
}

// Update Cars
function updateObstacles() {
    obstacles.forEach(o => {
        o.y += o.speed;

        if (o.lane === targetLane &&
            o.y + o.height > playerY &&
            o.y < playerY + 130) {
                alive = false;
        }
    });

    obstacles = obstacles.filter(o => o.y < canvas.height + 300);
}

// Pause Screen
function drawPauseScreen() {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "white";
    ctx.font = "70px Arial";
    ctx.fillText("PAUSED", canvas.width/2 - 140, canvas.height/2);
}

// Game Over
function gameOver() {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "white";
    ctx.font = "60px Arial";
    ctx.fillText("GAME OVER", canvas.width/2 - 180, canvas.height/2);
}

// Game Loop
function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (!alive) {
        gameOver();
    }
    else if (paused) {
        drawPauseScreen();
    }
    else {
        // Road Lines
        ctx.strokeStyle = "white";
        ctx.lineWidth = 6;

        ctx.beginPath();
        ctx.moveTo(canvas.width/2 - 150, 0);
        ctx.lineTo(canvas.width/2 - 150, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(canvas.width/2 + 150, 0);
        ctx.lineTo(canvas.width/2 + 150, canvas.height);
        ctx.stroke();

        updatePlayerPosition();
        drawPlayer();

        drawObstacles();
        updateObstacles();

        // Difficulty increases
        speed += 0.002;

        score++;
        document.getElementById("score").innerText = "Score: " + score;
    }

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
